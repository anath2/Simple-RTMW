import pytest
import requests

import cv2
import numpy as np
from simple_rtmw.wholebody import Wholebody


@pytest.fixture(scope='module')
def image() -> np.ndarray:
    url = 'https://live.staticflickr.com/141/401685338_759da4a49a.jpg'
    image = requests.get(url).content
    img_array = np.asarray(bytearray(image), dtype=np.uint8)
    img = cv2.imdecode(img_array, cv2.IMREAD_COLOR)
    return img


@pytest.mark.network
def test_wholebody_e2e(tmp_path, image):
    """End-to-end tests for wholebody pose estimation"""
    whole_body = Wholebody(device='mps', models_base_dir=tmp_path)
    keypoints, scores = whole_body(image)
    assert isinstance(keypoints, np.ndarray)
    assert isinstance(scores, np.ndarray)

























































































































































































































